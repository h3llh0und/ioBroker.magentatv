const request = require('request');
const cheerio = require('cheerio');

function GetUserId(username, password) {
    const url = 'https://accounts.login.idm.telekom.com/oauth2/auth?claims={"id_token":{"urn:telekom.com:all":{"essential":false}}}&client_id=10LIVESAM30000004901NGTVMAGENTA000000000&prompt=x-no-sso&redirect_uri=https://web.magentatv.de/authn/idm&response_type=code&scope=openid+offline_access&x-customizing-xrds-id=mtv';
    request({
        method: 'GET',
        uri: url,
        jar: true
    }, function(error, response, body) {
        let $ = cheerio.load(body);
        const elements = $('input');

        let xsrf, xsrfValue, tid;

        for(let i = 0; i < elements.length; i++) {
            if(elements[i].attribs.name.startsWith('xsrf_')) {
                xsrf = elements[i].attribs.name;
                xsrfValue = elements[i].attribs.value;
            }
            else if(elements[i].attribs.name === 'tid') {
                tid = elements[i].attribs.value;
            }
        }

        const FormData = {
            'tid': tid,
            'x-show-cancel': 'false',
            'pw_usr': 'n.gerndt-landau@gmx.de',
            'pw_submit': '',
            'hidden_pwd': 'p1nk5p1d3r6',
            'bdata': '[["m","n",{"vendorSub":"","productSub":"20030107","vendor":"Google+Inc.","maxTouchPoints":0,"userActivation":{},"doNotTrack":null,"geolocation":{},"connection":{},"webkitTemporaryStorage":{},"webkitPersistentStorage":{},"hardwareConcurrency":12,"cookieEnabled":true,"appCodeName":"Mozilla","appName":"Netscape","appVersion":"5.0+(Windows+NT+10.0;+Win64;+x64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/96.0.4664.110+Safari/537.36","platform":"Win32","product":"Gecko","userAgent":"Mozilla/5.0+(Windows+NT+10.0;+Win64;+x64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/96.0.4664.110+Safari/537.36","language":"de-DE","languages":["de-DE","de","en-US","en","ja"],"onLine":true,"webdriver":false,"pdfViewerEnabled":true,"scheduling":{},"bluetooth":{},"clipboard":{},"credentials":{},"keyboard":{},"managed":{},"mediaDevices":{},"storage":{},"serviceWorker":{},"wakeLock":{},"deviceMemory":8,"ink":{},"hid":{},"locks":{},"mediaCapabilities":{},"mediaSession":{},"permissions":{},"presentation":{},"serial":{},"virtualKeyboard":{},"usb":{},"xr":{},"userAgentData":{"brands":[{"brand":"+Not+A;Brand","version":"99"},{"brand":"Chromium","version":"96"},{"brand":"Google+Chrome","version":"96"}],"mobile":false}}],["m","s",{"availWidth":1920,"availHeight":1040,"width":1920,"height":1080,"colorDepth":24,"pixelDepth":24,"availLeft":-1920,"availTop":0,"orientation":{}}],["m","v",261],["m","e",{"ptype":"pc","ptypes":{"mouse":248},"k229":0,"kn":0,"tz":-60,"pr":1,"u":{"8":3,"9":16,"10":60,"11":20,"12":1},"f":[1,"[object+ServiceWorkerContainer]","[object+Geolocation]","true","undefined","20030107","undefined","false","[object+WebGLRenderingContext]","function+HTMLCanvasElement()+{+[native+code]+}","true","false","null","Win32","undefined","true","false","true","true","{\"0\":\"Mozilla/5.0+(Windows+NT+10.0;+Win64;+x64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/96.0.4664.110+Safari/537.36\",\"1\":\"de-DE\",\"2\":\"true\",\"3\":\"1920x1080x24\",\"4\":\"24\",\"5\":\"\",\"6\":\"\",\"7\":\"\",\"8\":\"-60\",\"9\":\"true\",\"10\":\"true\",\"11\":\"1\",\"12\":{\"0\":\"PDF+Viewer|Portable+Document+Format|application/pdf:pdf|text/pdf:pdf\",\"1\":\"Chrome+PDF+Viewer|Portable+Document+Format|application/pdf:pdf|text/pdf:pdf\",\"2\":\"Chromium+PDF+Viewer|Portable+Document+Format|application/pdf:pdf|text/pdf:pdf\",\"3\":\"Microsoft+Edge+PDF+Viewer|Portable+Document+Format|application/pdf:pdf|text/pdf:pdf\",\"4\":\"WebKit+built-in+PDF|Portable+Document+Format|application/pdf:pdf|text/pdf:pdf\"}}"]}],["m","k",{},[["Z",561,1642093229811],["U",2931,"email#pw_usr"],["r",2931,""],["v",6121,""],["n",6121,"email#pw_usr"],["n",6126,"password#hidden_pwd"],["U",6126,"password#hidden_pwd"],["D",6127,"DIV##BODY#"],["U",6129,"email#pw_usr"],["E",6162,"DIV##BODY#"],["D",6782,"submit#pw_submit"],["n",6783,"submit#pw_submit"],["E",6857,"submit#pw_submit"],["i",6858,"FORM#login#DIV#"]]],["c",[["t","DIV##BODY#",604],["v",1903,969,604],["mm",448,304,604],["mm",456,302,612],["mm",467,300,616],["mm",483,299,626],["mm",519,299,633],["mm",563,299,642],["mm",628,305,653],["mm",682,315,656],["t","H1##DIV#tbs-headline",666],["mm",740,328,666],["mm",813,345,671],["mm",872,361,686],["mm",943,384,687],["mm",989,402,705],["mm",1031,419,706],["mm",1070,438,711],["t","DIV##DIV#",729],["mm",1097,453,729],["mm",1111,465,729],["t","INPUT#username#DIV#",738],["mm",1124,476,738],["mm",1136,485,748],["mm",1141,491,752],["mm",1146,497,762],["mm",1150,505,768],["mm",1151,507,778],["mm",1155,517,782],["mm",1156,524,792],["mm",1157,530,803],["t","DIV##DIV#",808],["mm",1158,537,808],["mm",1159,542,825],["mm",1160,546,826],["mm",1161,549,832],["mm",1161,551,842],["mm",1161,552,848],["mm",1162,553,858],["mm",1162,555,864],["mm",1162,556,885],["mm",1162,557,905],["mm",1162,558,914],["mm",1162,559,918],["t","BUTTON#pw_submit#DIV#",928],["mm",1162,561,928],["mm",1161,561,938],["mm",1159,563,944],["mm",1157,566,957],["mm",1155,567,959],["mm",1153,568,971],["mm",1140,571,980],["mm",1131,572,984],["mm",1121,572,994],["mm",1112,572,1000],["mm",1105,572,1010],["mm",1095,572,1023],["mm",1088,573,1024],["mm",1081,573,1034],["mm",1071,574,1040],["mm",1063,574,1051],["mm",1055,574,1054],["mm",1049,574,1066],["mm",1043,574,1077],["mm",1038,574,1083],["mm",1032,574,1090],["mm",1028,574,1096],["mm",1026,574,1106],["mm",1024,574,1110],["mm",1023,574,1130],["mm",1022,574,1138],["mm",1020,574,1152],["mm",1019,574,1162],["mm",1017,575,1176],["mm",1015,575,1187],["mm",1013,575,1190],["mm",1011,576,1207],["mm",1009,576,1216],["mm",1008,576,1232],["mm",1007,576,1242],["mm",1006,576,1270],["mm",1005,576,1284],["mm",1004,576,1300],["mm",1003,576,1309],["mm",1002,576,1320],["mm",1000,576,1331],["mm",1000,577,1338],["mm",999,577,1342],["mm",997,577,1352],["mm",996,577,1363],["mm",995,577,1368],["mm",994,578,1379],["mm",992,578,1382],["mm",990,578,1405],["mm",988,578,1410],["mm",985,579,1424],["mm",979,583,1436],["mm",967,592,1446],["mm",947,608,1449],["t","BUTTON##DIV#",1462],["mm",924,629,1462],["mm",900,655,1464],["t","DIV##DIV#",1474],["mm",874,679,1474],["t","P##DIV#",1478],["mm",845,708,1478],["t","P##DIV#",1488],["mm",825,727,1488],["t","DIV##DIV#",1498],["mm",807,743,1498],["mm",779,770,1516],["t","DIV##DIV#",1518],["mm",771,777,1518],["mm",769,782,1528],["mm",763,788,1542],["mm",760,795,1544],["t","DIV##DIV#",1557],["mm",757,802,1557],["mm",753,812,1562],["mm",750,820,1570],["t","DIV##DIV#",1574],["mm",748,826,1574],["mm",747,834,1584],["mm",744,843,1594],["mm",742,852,1600],["mm",739,858,1611],["mm",736,865,1614],["mm",733,869,1624],["mm",730,872,1634],["mm",730,874,1641],["mm",728,875,1650],["t","DIV##DIV#",1656],["mm",727,877,1656],["mm",726,877,1666],["mm",724,879,1676],["mm",720,883,1680],["mm",718,887,1690],["t","DIV##BODY#",1696],["mm",710,893,1696],["mm",705,899,1708],["mm",699,906,1710],["mm",694,911,1720],["mm",689,918,1730],["mm",684,922,1736],["mm",680,926,1746],["mm",678,931,1750],["mm",674,936,1760],["mm",670,942,1767],["mm",667,947,1776],["mm",662,955,1787],["mm",656,963,1793],["mm",655,966,3059],["mm",655,966,3059],["mm",661,958,3064],["mm",666,953,3074],["mm",671,947,3077],["mm",679,939,3087],["mm",686,931,3093],["mm",695,921,3104],["mm",702,915,3113],["t","P##DIV#",3117],["mm",714,901,3117],["t","DIV##DIV#",3129],["mm",726,889,3129],["t","DIV##DIV#",3134],["mm",740,874,3134],["t","I##DIV#",5612],["mm",348,60,5612],["mm",348,60,5612],["mm",345,54,5629],["mm",343,48,5632],["mm",343,45,5638],["mm",341,40,5648],["mm",339,35,5652],["mm",337,30,5663],["mm",336,27,5675],["mm",335,25,5681],["t","DIV##DIV#",5691],["mm",331,20,5691],["mm",328,18,5696],["mm",323,16,5706],["mm",320,15,5711],["mm",319,14,5718],["mm",317,14,5728],["mm",315,14,5734],["t","DIV##DIV#tbs-header-content",5746],["mm",314,14,5746],["mm",312,14,5758],["mm",311,14,5774],["mm",311,15,5784],["mm",310,15,5798],["mm",309,15,5814],["mm",309,16,5824],["mm",308,16,5830],["mm",305,17,5840],["mm",304,18,5843],["t","DIV#tbs-header-content#HEADER#tbs-header",5854],["mm",301,19,5854],["mm",299,19,5863],["mm",298,19,5870],["mm",296,21,5880],["mm",294,22,5884],["mm",292,23,5894],["mm",290,24,5902],["mm",287,28,5913],["mm",284,31,5923],["mm",282,38,5929],["mm",280,48,5936],["mm",278,55,5940],["mm",276,68,5951],["mm",274,82,5961],["t","DIV##BODY#",5967],["mm",273,94,5967],["mm",272,110,5979],["mm",269,124,5981],["mm",268,133,5996],["mm",268,144,6002],["mm",268,154,6009],["mm",267,166,6021],["mm",267,173,6022],["mm",267,178,6035],["mm",267,183,6038],["mm",267,185,6046],["mm",267,186,6057],["mm",267,187,6063],["md",267,187,6126,0],["mm",267,187,6129],["mm",267,187,6149],["mu",267,187,6161,0],["mm",267,186,6172],["mm",267,185,6185],["mm",270,184,6187],["mm",272,184,6198],["mm",280,183,6204],["mm",291,183,6216],["t","DIV#global-info-box#DIV#",6224],["mm",313,183,6224],["mm",340,188,6228],["mm",369,194,6240],["mm",402,204,6245],["mm",437,215,6254],["t","BODY##HTML#",6260],["mm",486,233,6260],["mm",525,248,6273],["t","DIV##BODY#",6282],["mm",580,268,6282],["mm",621,285,6286],["mm",674,311,6296],["t","H1##DIV#tbs-headline",6300],["mm",720,339,6300],["mm",750,360,6311],["mm",780,379,6316],["mm",792,391,6326],["mm",814,413,6344],["mm",821,423,6350],["mm",829,436,6356],["t","DIV##DIV#",6368],["mm",835,446,6368],["mm",839,455,6379],["mm",843,468,6382],["t","INPUT#username#DIV#",6394],["mm",849,480,6394],["mm",855,496,6412],["mm",860,508,6413],["mm",867,525,6416],["t","DIV##DIV#",6422],["mm",873,536,6422],["mm",877,547,6432],["t","BUTTON#pw_submit#DIV#",6435],["mm",885,561,6435],["mm",890,570,6446],["mm",895,580,6451],["mm",899,585,6462],["mm",902,589,6468],["mm",904,592,6481],["mm",905,593,6488],["mm",906,594,6504],["mm",906,595,6647],["mm",906,596,6674],["md",906,596,6781,0],["mu",906,596,6856,0]],"/oauth2/auth"],["w",[{"email#pw_usr":22},{"password#hidden_pwd":11},{"movement":0}],"VIEW_USERNAME"]]'
        };
        FormData[xsrf] = xsrfValue;

        request({
            method: 'Post',
            uri: 'https://accounts.login.idm.telekom.com/factorx',
            FormData: FormData,
            jar: true
        }, function(error, response, body) {
            $ = cheerio.load(body);
        });
    });
}


module.exports = GetUserId;